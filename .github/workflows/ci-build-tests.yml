name: ğŸš€ FluxStack v1.4.0 - Complete Build & Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:  # Allow manual triggering

env:
  BUN_VERSION: '1.1.34'
  NODE_VERSION: '20'

jobs:
  # ğŸ“¦ Test unified dependency installation
  installation-test:
    name: ğŸ“¦ Monorepo Installation Test
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“Š Test installation performance
        run: |
          echo "## ğŸ“¦ Installation Performance Test"
          echo "| Metric | Value | Status |"
          echo "|--------|-------|--------|"

          time_start=$(date +%s)
          bun install
          time_end=$(date +%s)
          duration=$((time_end - time_start))

          echo "| Installation Time | ${duration}s | âœ… |"

          # Verify single node_modules
          if [ -d "node_modules" ] && [ ! -d "app/client/node_modules" ]; then
            echo "| Monorepo Structure | Unified | âœ… |"
            echo "| node_modules Location | Root Only | âœ… |"
          else
            echo "| Monorepo Structure | Invalid | âŒ |"
            exit 1
          fi

          echo ""
          echo "âœ… **Installation completed successfully in ${duration}s**"

      - name: ğŸ“‹ Verify dependencies availability
        run: |
          echo "## ğŸ“¦ Dependency Availability Check"
          echo "| Component | Package | Status | Version |"
          echo "|-----------|---------|--------|---------|"

          # Check React (frontend)
          react_version=$(bun pm ls | grep "react@" | head -1 | awk '{print $2}' || echo "missing")
          if bun pm ls | grep -q "react@"; then
            echo "| Frontend | React | âœ… | $react_version |"
          else
            echo "| Frontend | React | âŒ | missing |"
            exit 1
          fi

          # Check Elysia (backend)
          elysia_version=$(bun pm ls | grep "elysia@" | head -1 | awk '{print $2}' || echo "missing")
          if bun pm ls | grep -q "elysia@"; then
            echo "| Backend | Elysia | âœ… | $elysia_version |"
          else
            echo "| Backend | Elysia | âŒ | missing |"
            exit 1
          fi

          # Check TypeScript (shared)
          typescript_version=$(bun pm ls | grep "typescript@" | head -1 | awk '{print $2}' || echo "missing")
          if bun pm ls | grep -q "typescript@"; then
            echo "| Shared | TypeScript | âœ… | $typescript_version |"
          else
            echo "| Shared | TypeScript | âŒ | missing |"
            exit 1
          fi

          # Check Vite (build)
          vite_version=$(bun pm ls | grep "vite@" | head -1 | awk '{print $2}' || echo "missing")
          if bun pm ls | grep -q "vite@"; then
            echo "| Build | Vite | âœ… | $vite_version |"
          else
            echo "| Build | Vite | âŒ | missing |"
          fi

          echo ""
          echo "âœ… **All critical dependencies verified**"

  # ğŸ§ª Run all 30 tests
  test-suite:
    name: ğŸ§ª Complete Test Suite (30 Tests)
    runs-on: ubuntu-latest
    needs: installation-test
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ§ª Run all tests
        run: |
          echo "ğŸ”¬ Running complete test suite..."
          bun run test

      - name: ğŸ“Š Generate test coverage
        run: |
          echo "ğŸ“ˆ Generating test coverage report..."
          bun run test:coverage

      - name: ğŸ“‹ Upload coverage reports
        uses: codecov/codecov-action@v3
        with:
          fail_ci_if_error: false

  # ğŸ¨ Frontend build isolation test
  frontend-build-test:
    name: ğŸ¨ Frontend Build Isolation
    runs-on: ubuntu-latest
    needs: installation-test
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ¨ Build frontend only
        run: |
          echo "ğŸ—ï¸ Testing isolated frontend build..."
          bun run build:frontend

      - name: âœ… Verify frontend build artifacts
        run: |
          echo "## ğŸ¨ Frontend Build Verification"
          echo "| Artifact | Status | Size |"
          echo "|----------|--------|------|"

          # Check dist/client directory
          if [ -d "dist/client" ]; then
            dist_size=$(du -sh dist/client/ | cut -f1)
            echo "| dist/client/ | âœ… | $dist_size |"
          else
            echo "| dist/client/ | âŒ | missing |"
            exit 1
          fi

          # Check index.html
          if [ -f "dist/client/index.html" ]; then
            html_size=$(du -sh dist/client/index.html | cut -f1)
            echo "| index.html | âœ… | $html_size |"
          else
            echo "| index.html | âŒ | missing |"
            exit 1
          fi

          # Check assets directory
          if [ -d "dist/client/assets" ]; then
            assets_size=$(du -sh dist/client/assets/ | cut -f1)
            assets_count=$(ls -1 dist/client/assets/ | wc -l)
            echo "| assets/ | âœ… | $assets_size ($assets_count files) |"

            echo ""
            echo "### ğŸ“‹ Generated Assets"
            echo "| File | Size | Type |"
            echo "|------|------|------|"
            for file in dist/client/assets/*; do
              if [ -f "$file" ]; then
                filename=$(basename "$file")
                filesize=$(du -sh "$file" | cut -f1)
                extension="${filename##*.}"
                echo "| $filename | $filesize | $extension |"
              fi
            done
          else
            echo "| assets/ | âŒ | missing |"
            exit 1
          fi

          echo ""
          echo "âœ… **Frontend build verification completed**"

      - name: ğŸ“ Check bundle size
        run: |
          echo "## ğŸ“Š Bundle Size Analysis"

          total_size=$(du -sh dist/client/ | cut -f1)
          echo "**Total Frontend Bundle:** $total_size"
          echo ""

          echo "| Asset Type | Count | Total Size | Avg Size |"
          echo "|------------|-------|------------|----------|"

          # JavaScript files
          js_count=$(find dist/client/assets -name "*.js" 2>/dev/null | wc -l)
          if [ "$js_count" -gt 0 ]; then
            js_total=$(find dist/client/assets -name "*.js" -exec du -c {} + 2>/dev/null | tail -1 | cut -f1)
            js_total_kb=$((js_total / 1024))
            js_avg=$((js_total_kb / js_count))
            echo "| JavaScript | $js_count | ${js_total_kb}KB | ${js_avg}KB |"
          else
            echo "| JavaScript | 0 | 0KB | 0KB |"
          fi

          # CSS files
          css_count=$(find dist/client/assets -name "*.css" 2>/dev/null | wc -l)
          if [ "$css_count" -gt 0 ]; then
            css_total=$(find dist/client/assets -name "*.css" -exec du -c {} + 2>/dev/null | tail -1 | cut -f1)
            css_total_kb=$((css_total / 1024))
            css_avg=$((css_total_kb / css_count))
            echo "| CSS | $css_count | ${css_total_kb}KB | ${css_avg}KB |"
          else
            echo "| CSS | 0 | 0KB | 0KB |"
          fi

          # Other assets
          other_count=$(find dist/client/assets -type f ! -name "*.js" ! -name "*.css" 2>/dev/null | wc -l)
          if [ "$other_count" -gt 0 ]; then
            other_total=$(find dist/client/assets -type f ! -name "*.js" ! -name "*.css" -exec du -c {} + 2>/dev/null | tail -1 | cut -f1)
            other_total_kb=$((other_total / 1024))
            other_avg=$((other_total_kb / other_count))
            echo "| Other | $other_count | ${other_total_kb}KB | ${other_avg}KB |"
          else
            echo "| Other | 0 | 0KB | 0KB |"
          fi

          echo ""
          echo "âœ… **Bundle analysis completed**"

  # âš¡ Backend build isolation test
  backend-build-test:
    name: âš¡ Backend Build Isolation  
    runs-on: ubuntu-latest
    needs: installation-test
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: âš¡ Build backend only
        run: |
          echo "ğŸ—ï¸ Testing isolated backend build..."
          bun run build:backend

      - name: âœ… Verify backend build artifacts
        run: |
          echo "## âš¡ Backend Build Verification"
          echo "| Artifact | Status | Size | Type |"
          echo "|----------|--------|------|------|"

          if [ -f "dist/index.js" ]; then
            bundle_size=$(du -sh dist/index.js | cut -f1)
            bundle_size_bytes=$(stat -c%s dist/index.js)
            echo "| dist/index.js | âœ… | $bundle_size | Bundle |"

            # Additional backend files
            if [ -d "dist" ]; then
              file_count=$(find dist -type f | wc -l)
              total_size=$(du -sh dist/ | cut -f1)
              echo "| Total dist/ | âœ… | $total_size | $file_count files |"
            fi

            echo ""
            echo "### ğŸ“Š Bundle Analysis"
            echo "| Metric | Value |"
            echo "|--------|-------|"
            echo "| Size (bytes) | $bundle_size_bytes |"
            echo "| Size (human) | $bundle_size |"

            if [ "$bundle_size_bytes" -gt 5000000 ]; then
              echo "| Status | âš ï¸ Large (>5MB) |"
            elif [ "$bundle_size_bytes" -gt 1000000 ]; then
              echo "| Status | âœ… Medium (1-5MB) |"
            else
              echo "| Status | âœ… Small (<1MB) |"
            fi
          else
            echo "| dist/index.js | âŒ | missing | Bundle |"
            exit 1
          fi

          echo ""
          echo "âœ… **Backend build verification completed**"

      - name: ğŸ§ª Test backend bundle execution
        run: |
          echo "## ğŸ§ª Backend Execution Test"
          echo "| Test | Status | Result |"
          echo "|------|--------|--------|"

          if timeout 10s bun dist/index.js 2>&1 | grep -q "Server running" || true; then
            echo "| Bundle Execution | âœ… | Successful |"
            echo "| Server Startup | âœ… | Detected |"
          else
            echo "| Bundle Execution | âš ï¸ | No server output |"
          fi

          echo "| Timeout Test | âœ… | 10s limit |"
          echo ""
          echo "âœ… **Backend execution test completed**"

  # ğŸš€ Full-stack unified build test  
  fullstack-build-test:
    name: ğŸš€ Full-Stack Unified Build
    runs-on: ubuntu-latest
    needs: installation-test
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ—ï¸ Full unified build
        run: |
          echo "ğŸ”§ Testing unified full-stack build..."
          bun run build

      - name: âœ… Verify complete build artifacts
        run: |
          echo "ğŸ” Checking complete build output..."
          
          # Check frontend artifacts
          if [ -d "dist/client" ] && [ -f "dist/client/index.html" ]; then
            echo "âœ… Frontend build completed"
          else
            echo "âŒ Frontend build incomplete"
            exit 1
          fi
          
          # Check backend artifacts  
          if [ -f "dist/index.js" ]; then
            echo "âœ… Backend build completed"
          else
            echo "âŒ Backend build incomplete"
            exit 1
          fi
          
          echo "ğŸ“Š Complete build size:"
          du -sh dist/

      - name: ğŸš€ Test production server simulation
        run: |
          echo "ğŸŒ Testing production server startup..."
          timeout 15s bun run start &
          sleep 5
          
          # Test API endpoint
          if curl -f http://localhost:3000/api/health; then
            echo "âœ… Production server API responding"
          else
            echo "âŒ Production server API not responding"
            exit 1
          fi

  # ğŸ”§ Development mode tests
  development-mode-test:
    name: ğŸ”§ Development Modes Test
    runs-on: ubuntu-latest  
    needs: installation-test
    strategy:
      matrix:
        mode: [frontend, backend]
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ”§ Test ${{ matrix.mode }} development mode
        run: |
          echo "ğŸš€ Testing ${{ matrix.mode }} development mode..."
          
          if [ "${{ matrix.mode }}" == "frontend" ]; then
            timeout 30s bun run dev:frontend &
            sleep 10
            if curl -f http://localhost:5173; then
              echo "âœ… Frontend dev server responding"
            else
              echo "âŒ Frontend dev server not responding"
              exit 1
            fi
          fi
          
          if [ "${{ matrix.mode }}" == "backend" ]; then
            timeout 30s bun run dev:backend &  
            sleep 10
            if curl -f http://localhost:3001/api/health; then
              echo "âœ… Backend dev server responding"
            else
              echo "âŒ Backend dev server not responding"  
              exit 1
            fi
          fi

  # ğŸ³ Docker build tests - DISABLED
  # docker-build-test:
  #   name: ğŸ³ Docker Build Test
  #   runs-on: ubuntu-latest
  #   needs: [frontend-build-test, backend-build-test]
  #   steps:
  #     - name: ğŸ“¥ Checkout repository
  #       uses: actions/checkout@v4

  #     - name: ğŸ³ Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v3

  #     - name: ğŸ—ï¸ Build Docker image
  #       run: |
  #         echo "ğŸ³ Building FluxStack Docker image..."
  #         docker build -t fluxstack:test .

  #     - name: ğŸ§ª Test Docker container
  #       run: |
  #         echo "ğŸš€ Testing Docker container..."
  #         docker run -d -p 3000:3000 --name fluxstack-test fluxstack:test
  #         sleep 10

  #         if curl -f http://localhost:3000/api/health; then
  #           echo "âœ… Docker container API responding"
  #         else
  #           echo "âŒ Docker container API not responding"
  #           exit 1
  #         fi

  #         docker stop fluxstack-test

  # ğŸ”„ Hot reload simulation test
  hot-reload-test:
    name: ğŸ”„ Hot Reload Independence Test
    runs-on: ubuntu-latest
    needs: installation-test  
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ”¥ Test hot reload independence
        run: |
          echo "ğŸ”„ Testing hot reload independence..."
          
          # Start full-stack dev mode
          timeout 60s bun run dev &
          DEV_PID=$!
          sleep 15
          
          # Verify both servers are running
          if curl -f http://localhost:3000/api/health && curl -f http://localhost:5173; then
            echo "âœ… Both frontend and backend started successfully"
          else
            echo "âŒ Development servers failed to start"
            kill $DEV_PID 2>/dev/null || true
            exit 1
          fi
          
          kill $DEV_PID 2>/dev/null || true

  # ğŸ“Š Performance benchmarks
  performance-test:
    name: ğŸ“Š Performance Benchmarks
    runs-on: ubuntu-latest
    needs: installation-test
    steps:
      - name: ğŸ“¥ Checkout repository  
        uses: actions/checkout@v4

      - name: ğŸš€ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: ${{ env.BUN_VERSION }}

      - name: â±ï¸ Benchmark installation speed
        run: |
          echo "## âš¡ Installation Performance Benchmark"

          rm -rf node_modules bun.lockb

          time_start=$(date +%s%3N)
          bun install
          time_end=$(date +%s%3N)
          duration=$((time_end - time_start))

          echo "| Metric | Value | Target | Status |"
          echo "|--------|-------|--------|--------|"
          echo "| Install Time | ${duration}ms | <15000ms | $([[ $duration -lt 15000 ]] && echo 'âœ… PASS' || echo 'âš ï¸ SLOW') |"

          # Additional metrics
          package_count=$(bun pm ls --depth=0 | wc -l)
          node_modules_size=$(du -sh node_modules | cut -f1)

          echo "| Package Count | $package_count | - | â„¹ï¸ |"
          echo "| node_modules Size | $node_modules_size | - | â„¹ï¸ |"

          duration_seconds=$((duration / 1000))
          packages_per_second=$((package_count / duration_seconds))

          echo "| Packages/Second | $packages_per_second | - | â„¹ï¸ |"

          echo ""
          if [ $duration -lt 15000 ]; then
            echo "âœ… **Installation performance acceptable** (${duration}ms)"
          else
            echo "âš ï¸ **Installation slower than expected** (${duration}ms vs 15000ms target)"
          fi

      - name: â±ï¸ Benchmark build performance
        run: |
          echo "## ğŸ—ï¸ Build Performance Benchmarks"
          echo "| Build Type | Duration | Target | Status | Output Size |"
          echo "|------------|----------|--------|--------|-------------|"

          # Frontend build benchmark
          time_start=$(date +%s%3N)
          bun run build:frontend
          time_end=$(date +%s%3N)
          frontend_duration=$((time_end - time_start))

          frontend_size="0B"
          if [ -d "dist/client" ]; then
            frontend_size=$(du -sh dist/client | cut -f1)
          fi

          echo "| ğŸ¨ Frontend | ${frontend_duration}ms | <30000ms | $([[ $frontend_duration -lt 30000 ]] && echo 'âœ… FAST' || echo 'âš ï¸ SLOW') | $frontend_size |"

          # Backend build benchmark
          rm -rf dist/index.js 2>/dev/null || true
          time_start=$(date +%s%3N)
          bun run build:backend
          time_end=$(date +%s%3N)
          backend_duration=$((time_end - time_start))

          backend_size="0B"
          if [ -f "dist/index.js" ]; then
            backend_size=$(du -sh dist/index.js | cut -f1)
          fi

          echo "| âš¡ Backend | ${backend_duration}ms | <20000ms | $([[ $backend_duration -lt 20000 ]] && echo 'âœ… FAST' || echo 'âš ï¸ SLOW') | $backend_size |"

          # Total unified build
          rm -rf dist/ 2>/dev/null || true
          time_start=$(date +%s%3N)
          bun run build
          time_end=$(date +%s%3N)
          total_duration=$((time_end - time_start))

          total_size="0B"
          if [ -d "dist" ]; then
            total_size=$(du -sh dist | cut -f1)
          fi

          echo "| ğŸš€ Full-Stack | ${total_duration}ms | <45000ms | $([[ $total_duration -lt 45000 ]] && echo 'âœ… FAST' || echo 'âš ï¸ SLOW') | $total_size |"

          echo ""
          echo "### ğŸ“Š Build Efficiency Analysis"
          echo "| Metric | Value |"
          echo "|--------|-------|"

          # Calculate efficiency metrics
          total_seconds=$((total_duration / 1000))
          if [ $total_seconds -gt 0 ]; then
            mb_per_second="0"
            if [ -d "dist" ]; then
              total_bytes=$(du -sb dist | cut -f1)
              total_mb=$((total_bytes / 1024 / 1024))
              if [ $total_mb -gt 0 ]; then
                mb_per_second=$((total_mb / total_seconds))
              fi
            fi
            echo "| Build Speed | ${mb_per_second}MB/s |"
          fi

          frontend_seconds=$((frontend_duration / 1000))
          backend_seconds=$((backend_duration / 1000))
          if [ $frontend_seconds -gt $backend_seconds ]; then
            parallel_estimate=$frontend_seconds
          else
            parallel_estimate=$backend_seconds
          fi

          echo "| Sequential Time | ${total_seconds}s |"
          echo "| Parallel Estimate | ${parallel_estimate}s |"
          echo "| Time Saved | $((total_seconds - parallel_estimate))s |"

          echo ""
          echo "âœ… **Build performance analysis completed**"

  # âœ… Summary job
  build-summary:
    name: âœ… Build Test Summary
    runs-on: ubuntu-latest
    needs: [
      installation-test,
      test-suite,
      frontend-build-test,
      backend-build-test,
      fullstack-build-test,
      development-mode-test,
      hot-reload-test,
      performance-test
    ]
    if: always()
    steps:
      - name: ğŸ“‹ Build Summary
        run: |
          echo "# ğŸ‰ FluxStack v1.4.0 Build Test Summary"
          echo ""
          echo "## ğŸ“Š Test Results Overview"
          echo "| Test Suite | Status | Duration |"
          echo "|------------|--------|----------|"

          # Format each result with appropriate emoji
          installation_icon="$([[ "${{ needs.installation-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          test_suite_icon="$([[ "${{ needs.test-suite.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          frontend_icon="$([[ "${{ needs.frontend-build-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          backend_icon="$([[ "${{ needs.backend-build-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          fullstack_icon="$([[ "${{ needs.fullstack-build-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          dev_modes_icon="$([[ "${{ needs.development-mode-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          hot_reload_icon="$([[ "${{ needs.hot-reload-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"
          performance_icon="$([[ "${{ needs.performance-test.result }}" == "success" ]] && echo 'âœ…' || echo 'âŒ')"

          echo "| ğŸ“¦ Monorepo Installation | $installation_icon ${{ needs.installation-test.result }} | - |"
          echo "| ğŸ§ª Test Suite (30 tests) | $test_suite_icon ${{ needs.test-suite.result }} | - |"
          echo "| ğŸ¨ Frontend Build | $frontend_icon ${{ needs.frontend-build-test.result }} | - |"
          echo "| âš¡ Backend Build | $backend_icon ${{ needs.backend-build-test.result }} | - |"
          echo "| ğŸš€ Full-Stack Build | $fullstack_icon ${{ needs.fullstack-build-test.result }} | - |"
          echo "| ğŸ”§ Development Modes | $dev_modes_icon ${{ needs.development-mode-test.result }} | - |"
          echo "| ğŸ”„ Hot Reload | $hot_reload_icon ${{ needs.hot-reload-test.result }} | - |"
          echo "| ğŸ“ˆ Performance | $performance_icon ${{ needs.performance-test.result }} | - |"

          echo ""

          # Count successes
          success_count=0
          total_count=8

          [[ "${{ needs.installation-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.test-suite.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.frontend-build-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.backend-build-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.fullstack-build-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.development-mode-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.hot-reload-test.result }}" == "success" ]] && ((success_count++))
          [[ "${{ needs.performance-test.result }}" == "success" ]] && ((success_count++))

          success_percentage=$((success_count * 100 / total_count))

          echo "## ğŸ“ˆ Overall Results"
          echo "| Metric | Value |"
          echo "|--------|-------|"
          echo "| Success Rate | $success_count/$total_count ($success_percentage%) |"
          echo "| Failed Tests | $((total_count - success_count)) |"
          echo "| Status | $([[ $success_count -eq $total_count ]] && echo 'ğŸ‰ ALL PASSED' || echo 'âŒ SOME FAILED') |"

          echo ""
          if [ $success_count -eq $total_count ]; then
            echo "ğŸ‰ **FluxStack v1.4.0 monorepo architecture fully validated!**"
            echo "âœ… Ready for production deployment"
          else
            echo "âŒ **Some tests failed - check individual job results**"
            echo "âš ï¸ Review failed tests before proceeding"
          fi

      - name: âŒ Fail if any test failed
        if: |
          needs.installation-test.result == 'failure' ||
          needs.test-suite.result == 'failure' ||
          needs.frontend-build-test.result == 'failure' ||
          needs.backend-build-test.result == 'failure' ||
          needs.fullstack-build-test.result == 'failure' ||
          needs.development-mode-test.result == 'failure' ||
          needs.hot-reload-test.result == 'failure' ||
          needs.performance-test.result == 'failure'
        run: |
          echo "âŒ Some tests failed - check individual job results"
          exit 1